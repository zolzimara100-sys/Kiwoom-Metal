# í‚¤ì›€ì¦ê¶Œ ìë™ê±°ë˜ ì‹œìŠ¤í…œ - ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜

### í—¥ì‚¬ê³ ë‚  ì•„í‚¤í…ì²˜ (Ports & Adapters)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DRIVING ADAPTERS (IN)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Controllers  â”‚  â”‚ WebSocket     â”‚  â”‚ Schedulers       â”‚ â”‚
â”‚  â”‚ (REST API)   â”‚  â”‚ (Real-time)   â”‚  â”‚ (Batch Jobs)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â†“                  â†“                   â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        APPLICATION SERVICES (USE CASES)              â”‚  â”‚
â”‚  â”‚  - FetchInvestorTradingUseCase                       â”‚  â”‚
â”‚  â”‚  - QueryStockPriceUseCase                            â”‚  â”‚
â”‚  â”‚  - AuthenticateUseCase                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              DOMAIN MODELS (CORE)                    â”‚  â”‚
â”‚  â”‚  - InvestorTrading, StockPrice, Token, DailyBalance â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             OUTPUT PORTS (INTERFACES)                â”‚  â”‚
â”‚  â”‚  - InvestorTradingPort                               â”‚  â”‚
â”‚  â”‚  - KiwoomApiPort, CachePort, AuthPort                â”‚  â”‚
â”‚  â”‚  - PythonAnalysisPort                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         â†“                  â†“                   â†“           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Persistence  â”‚  â”‚ External API â”‚  â”‚ Cache (Redis)    â”‚ â”‚
â”‚  â”‚ (PostgreSQL) â”‚  â”‚ (Kiwoom API) â”‚  â”‚ (Real-time)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                    DRIVEN ADAPTERS (OUT)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/main/java/com/stocktrading/kiwoom/
â”œâ”€â”€ domain/                         # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ì˜ì¡´ì„± ì—†ìŒ)
â”‚   â”œâ”€â”€ model/                      # ë„ë©”ì¸ ëª¨ë¸ (JPA ë…ë¦½ì )
â”‚   â”‚   â”œâ”€â”€ InvestorTrading.java
â”‚   â”‚   â”œâ”€â”€ StockPrice.java
â”‚   â”‚   â”œâ”€â”€ Token.java
â”‚   â”‚   â””â”€â”€ DailyBalance.java
â”‚   â”œâ”€â”€ port/
â”‚   â”‚   â”œâ”€â”€ in/                     # Use Case ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”‚   â”œâ”€â”€ FetchInvestorTradingUseCase.java
â”‚   â”‚   â”‚   â”œâ”€â”€ QueryInvestorTradingUseCase.java
â”‚   â”‚   â”‚   â”œâ”€â”€ QueryStockPriceUseCase.java
â”‚   â”‚   â”‚   â””â”€â”€ AuthenticateUseCase.java
â”‚   â”‚   â””â”€â”€ out/                    # Infrastructure ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚       â”œâ”€â”€ InvestorTradingPort.java
â”‚   â”‚       â”œâ”€â”€ KiwoomApiPort.java
â”‚   â”‚       â”œâ”€â”€ CachePort.java
â”‚   â”‚       â”œâ”€â”€ AuthPort.java
â”‚   â”‚       â”œâ”€â”€ StockPricePort.java
â”‚   â”‚       â””â”€â”€ PythonAnalysisPort.java
â”‚   â””â”€â”€ tr/                         # TR(Transaction Request) ì¶”ìƒí™”
â”‚       â”œâ”€â”€ KiwoomTR.java           # ì¶”ìƒ í´ë˜ìŠ¤
â”‚       â”œâ”€â”€ InvestorTradingTR.java
â”‚       â”œâ”€â”€ StockPriceTR.java
â”‚       â””â”€â”€ TRFactory.java
â”‚
â”œâ”€â”€ application/                    # Use Case êµ¬í˜„
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ InvestorTradingApplicationService.java
â”‚       â”œâ”€â”€ AuthenticationApplicationService.java
â”‚       â”œâ”€â”€ StockPriceApplicationService.java
â”‚       â””â”€â”€ BatchAggregationScheduler.java
â”‚
â””â”€â”€ adapter/                        # ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ê²°
    â”œâ”€â”€ in/                         # Driving Adapters
    â”‚   â”œâ”€â”€ web/                    # REST Controllers (ê¸°ì¡´)
    â”‚   â””â”€â”€ websocket/              # WebSocket ì‹¤ì‹œê°„ ì²˜ë¦¬
    â”‚       â”œâ”€â”€ RealTimeStockPriceHandler.java
    â”‚       â””â”€â”€ ReactiveStockPriceProcessor.java
    â””â”€â”€ out/                        # Driven Adapters
        â”œâ”€â”€ persistence/            # DB ì–´ëŒ‘í„°
        â”‚   â”œâ”€â”€ entity/
        â”‚   â”‚   â”œâ”€â”€ StockInvestorDaily.java
        â”‚   â”‚   â””â”€â”€ StockInvestorDailyId.java
        â”‚   â”œâ”€â”€ repository/
        â”‚   â”‚   â””â”€â”€ StockInvestorDailyRepository.java
        â”‚   â”œâ”€â”€ InvestorTradingMapper.java
        â”‚   â””â”€â”€ InvestorTradingPersistenceAdapter.java
        â”œâ”€â”€ external/               # ì™¸ë¶€ API ì–´ëŒ‘í„°
        â”‚   â”œâ”€â”€ KiwoomApiAdapter.java
        â”‚   â””â”€â”€ PythonApiAdapter.java
        â””â”€â”€ cache/                  # Redis ì–´ëŒ‘í„°
            â”œâ”€â”€ RedisCacheAdapter.java
            â””â”€â”€ RedisAuthAdapter.java

python-analysis/                    # Python ë¶„ì„ ì„œë²„
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ analysis_router.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ schemas.py
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ technical_analysis_service.py
â””â”€â”€ requirements.txt
```

## ğŸ”„ ë°ì´í„° íë¦„

### 1. ì‹¤ì‹œê°„ ì£¼ê°€ ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

```
WebSocket (í‚¤ì›€ ì‹¤ì‹œê°„)
    â†“
RealTimeStockPriceHandler
    â†“
ReactiveStockPriceProcessor
    â”œâ†’ Redis ìºì‹± (TTL: 5ì´ˆ) - ì‹¤ì‹œê°„ ì¡°íšŒìš©
    â”œâ†’ Redis Pub/Sub ë°œí–‰ - ì´ë²¤íŠ¸ ì „íŒŒ
    â””â†’ ë°°ì¹˜ í ì¶”ê°€ - PostgreSQL ì €ì¥ ëŒ€ê¸°
        â†“
BatchAggregationScheduler (1ë¶„/5ë¶„/1ì‹œê°„/ì¼ë³„)
    â†“
PostgreSQL ì§‘ê³„ ì €ì¥ (ê³¼ê±° ë°ì´í„° ë¶„ì„ìš©)
```

### 2. API í˜¸ì¶œ íë¦„ (í—¥ì‚¬ê³ ë‚ )

```
Controller (REST API)
    â†“
Use Case Interface (Port In)
    â†“
Application Service (Use Case êµ¬í˜„)
    â†“
Output Port Interface
    â†“
Adapter êµ¬í˜„ì²´ (Infrastructure)
    â†“
ì™¸ë¶€ ì‹œìŠ¤í…œ (DB/API/Cache)
```

### 3. TR(Transaction) íŒ¨í„´

```java
// TR ì •ì˜
InvestorTradingTR tr = trFactory.createInvestorTradingTR();

// TR ì‹¤í–‰
TrendAnalysisResult result = tr.execute(
    request,
    token,
    apiAdapter  // KiwoomApiPort êµ¬í˜„ì²´
);
```

## ğŸ’¾ ë°ì´í„° ì €ì¥ ì „ëµ

| ë°ì´í„° ì¢…ë¥˜ | ì €ì¥ì†Œ | TTL/ë³´ê´€ê¸°ê°„ | ìš©ë„ |
|------------|--------|-------------|------|
| **ì‹¤ì‹œê°„ ì£¼ê°€** | Redis | 5ì´ˆ | ì‹¤ì‹œê°„ ì¡°íšŒ, ë¹ ë¥¸ ì‘ë‹µ |
| **ì¸ì¦ í† í°** | Redis | í† í° ë§Œë£Œì‹œê¹Œì§€ | ìë™ ê°±ì‹ , ì„¸ì…˜ ê´€ë¦¬ |
| **íˆ¬ìì ê±°ë˜** | PostgreSQL | ì˜êµ¬ | ê³¼ê±° ë¶„ì„, í†µê³„ |
| **ì§‘ê³„ ë°ì´í„°** | PostgreSQL | ì˜êµ¬ | 1ë¶„/5ë¶„/1ì‹œê°„/ì¼ë³„ OHLCV |
| **Rate Limit** | Redis | 1ë¶„ | API í˜¸ì¶œ ì œí•œ |

## ğŸ Python ë¶„ì„ ì„œë²„ í†µí•©

### Java â†’ Python í†µì‹ 

```java
// Javaì—ì„œ Python API í˜¸ì¶œ
PythonAnalysisPort pythonPort;

TrendAnalysisResult result = pythonPort.analyzeTrend(
    "005930",  // ì‚¼ì„±ì „ì
    30         // 30ì¼
).block();

// ê²°ê³¼: ì¶”ì„¸ ë°©í–¥, ê°•ë„, ì‹ í˜¸, ì‹ ë¢°ë„
```

### Python ë¶„ì„ ê¸°ëŠ¥

1. **ê¸°ìˆ ì  ì§€í‘œ**
   - MA (ì´ë™í‰ê· ), RSI, MACD, Bollinger Bands

2. **ì¶”ì„¸ ë¶„ì„**
   - ìƒìŠ¹/í•˜ë½/íš¡ë³´ íŒë‹¨
   - ë§¤ìˆ˜/ë§¤ë„ ì‹œê·¸ë„

3. **íˆ¬ìì íŒ¨í„´**
   - ì™¸êµ­ì¸/ê¸°ê´€/ê°œì¸ ë§¤ë§¤ ë¶„ì„
   - ìˆ˜ê¸‰ ê°•ë„ ê³„ì‚°

4. **ìƒê´€ê´€ê³„ ë¶„ì„**
   - ì¢…ëª© ê°„ ìƒê´€ê³„ìˆ˜
   - ë™ì¡°í™” ì§€ìˆ˜

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. PostgreSQL & Redis ì‹œì‘

```bash
docker-compose up -d
```

### 2. Java ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘

```bash
./gradlew bootRun
```

### 3. Python ë¶„ì„ ì„œë²„ ì‹œì‘

```bash
cd python-analysis
pip install -r requirements.txt
uvicorn app.main:app --reload
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§

- **Health Check**: http://localhost:8080/actuator/health
- **Metrics**: http://localhost:8080/actuator/metrics
- **Prometheus**: http://localhost:8080/actuator/prometheus
- **Python API Docs**: http://localhost:8000/docs

## ğŸ”§ ì£¼ìš” ì„¤ì •

### application.properties

```properties
# PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/kiwoom

# Redis
spring.data.redis.host=localhost
spring.data.redis.port=6379

# Python Analysis API
python.analysis.base-url=http://localhost:8000

# Kiwoom API
kiwoom.api.app-key=YOUR_APP_KEY
kiwoom.api.app-secret=YOUR_APP_SECRET
```

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

### TODO (êµ¬í˜„ í•„ìš”)

1. **Controller ë¦¬íŒ©í† ë§**: ê¸°ì¡´ Controllerë¥¼ Port ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
2. **WebSocket í´ë¼ì´ì–¸íŠ¸ ì™„ì„±**: ì‹¤ì œ í‚¤ì›€ WebSocket í”„ë¡œí† ì½œ êµ¬í˜„
3. **JSON íŒŒì‹±**: InvestorTradingApplicationServiceì˜ JSON íŒŒì‹± ë¡œì§
4. **ë°°ì¹˜ ì§‘ê³„ ë¡œì§**: BatchAggregationSchedulerì˜ ì‹¤ì œ ì§‘ê³„ êµ¬í˜„
5. **Python DB ì—°ê²°**: Pythonì—ì„œ PostgreSQL ì§ì ‘ ì¡°íšŒ
6. **ì—ëŸ¬ ì²˜ë¦¬**: ì „ì—­ Exception Handler êµ¬í˜„
7. **í…ŒìŠ¤íŠ¸ ì½”ë“œ**: ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

## ğŸ¯ ì•„í‚¤í…ì²˜ ì¥ì 

### 1. **ë…ë¦½ì„±** (Hexagonal í•µì‹¬)
- Domainì€ ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ (JPA, Spring ë…ë¦½)
- Infrastructure êµì²´ ìš©ì´ (PostgreSQL â†’ MySQL)
- í…ŒìŠ¤íŠ¸ ìš©ì´ì„± (Mock ìƒì„± ê°„í¸)

### 2. **í™•ì¥ì„±**
- ìƒˆë¡œìš´ TR ì¶”ê°€ ê°„í¸ (TRFactoryì— ë“±ë¡)
- ìƒˆë¡œìš´ Adapter ì¶”ê°€ ê°€ëŠ¥ (Kafka, MongoDB ë“±)
- Python ì™¸ ë‹¤ë¥¸ ì–¸ì–´ í†µí•© ê°€ëŠ¥

### 3. **ì‹¤ì‹œê°„ ì²˜ë¦¬**
- Redis ìºì‹±ìœ¼ë¡œ ë¹ ë¥¸ ì‘ë‹µ
- WebSocketìœ¼ë¡œ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
- Reactive Streamìœ¼ë¡œ ë°±í”„ë ˆì…” ì œì–´

### 4. **ë¶„ì„ íŒŒì›Œ**
- Pythonì˜ í’ë¶€í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©
- Javaì˜ ì•ˆì •ì„±ê³¼ Pythonì˜ ë¶„ì„ë ¥ ê²°í•©
- ë…ë¦½ì ì¸ ë¶„ì„ ì„œë²„ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Hexagonal Architecture](https://alistair.cockburn.us/hexagonal-architecture/)
- [Spring WebFlux](https://docs.spring.io/spring-framework/reference/web/webflux.html)
- [FastAPI](https://fastapi.tiangolo.com/)
- [Redis Pub/Sub](https://redis.io/docs/manual/pubsub/)
