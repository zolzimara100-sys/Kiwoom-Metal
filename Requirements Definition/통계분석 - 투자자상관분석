주가(`cur_prc`)와 투자자별 이동평균(수급) 간의 상관관계를 분석하여 **"누가 사야 오르는가? (주포 찾기)"**를 규명하는 것은 매우 의미 있는 시도입니다. 통계적 관점에서 분석 방향과 주의할 점, 그리고 이를 구현하기 위한 구체적인 방법론을 제안드립니다.

### 1. 통계적 분석 방향 및 주의사항

단순히 `현재가(Level)`와 `이동평균값(Level)` 자체의 상관계수를 구하면 **"가짜 상관(Spurious Correlation)"**의 함정에 빠질 수 있습니다. 두 데이터 모두 시간의 흐름에 따라 우상향하거나 우하향하는 **추세(Trend)**를 가지고 있기 때문입니다. (예: 주가도 오르고 물가도 오르면, 둘은 관계가 없어도 상관계수가 높게 나옵니다.)

따라서 다음과 같은 **데이터 전처리 및 분석 기법**을 제안합니다:

#### A. 변수 변환 (Stationarity 확보)
*   **주가(Y)**: 단순 가격(`cur_prc`) 대신 **일별 등락률(Daily Return)** 또는 **로그 수익률(Log Return)**을 사용해야 합니다.
    *   *변환*: $(P_t - P_{t-1}) / P_{t-1}$
*   **투자자 이동평균(X)**: 단순 금액(`MA`)은 종목별 시가총액에 따라 스케일이 다르므로, **시가총액 대비 비중**으로 변환하거나, 과거 N일간의 흐름 내에서의 상대적 위치인 **Z-score(표준화)**를 사용하는 것이 좋습니다.

#### B. 시차 상관분석 (Lagged Cross-Correlation)
*   **동행성 vs 선행성**: "외국인이 사서 오른 것인가?" vs "오르니까 외국인이 산 것인가?"를 구분해야 합니다.
*   이를 위해 `투자자 MA` 변수에 **시차(Lag, t-1일, t-3일)**를 두어 분석하면, 특정 주체(예: 연기금)의 매수가 3일 뒤 주가 상승에 미치는 영향을 예측할 수 있습니다.

#### C. 주요 투자자(Feature Importance) 도출
*   모든 종목에 대해 일률적인 규칙은 없습니다. 삼성전자는 외국인 수급과 상관관계가 높지만, 중소형 코스닥 종목은 개인이나 사모펀드 수급과 연관될 수 있습니다.
*   **종목별/섹터별로** 상관계수가 가장 높은 "주도 투자자"를 식별하여 **"이 종목은 연기금 MA20을 봐야 한다"**는 인사이트를 도출해야 합니다.

---

### 2. 구체적인 분석 제안 (Action Plan)

Python(`pandas`, `seaborn`, `scipy`)을 활용하여 다음 분석을 수행하는 스크립트 작성을 제안합니다.

#### 분석 1: 상관관계 히트맵 (Correlation Heatmap)
*   특정 종목(예: 삼성전자)을 대상으로 주가와 12개 투자자 유형(MA5, 20, 60) 간의 상관계수 행렬을 시각화합니다.
*   **목표**: 한눈에 주가와 가장 붉은색(양의 상관관계)을 띠는 투자자를 찾습니다.

#### 분석 2: 종목별 '주포' 태깅 (Dominant Investor Tagging)
*   전체 종목을 대상으로 루프를 돌며 `주가 등락률`과 상관계수가 가장 높은 투자자 유형(Top 1)을 찾습니다.
*   **활용**: 차트 화면에 "이 종목은 **외국인 주도주**입니다 (상관계수 0.65)"와 같은 배지를 달아줄 수 있습니다.

#### 분석 3: 회귀 분석 (Regression Analysis)
*   `주가 등락률 = α + β1(외국인MA) + β2(기관MA) + ...` 회귀식을 세워, 각 투자자가 주가에 미치는 영향력($\beta$ 계수)의 크기와 유의성을 검증합니다.

---

### 3. 바로 실행할 수 있는 작업

사용자님의 데이터를 기반으로 **"종목별 주가와 가장 상관관계가 높은 투자자 Top 3"**를 추출하는 Python 분석 스크립트(`analyze_price_investor_correlation.py`)를 작성해 드릴 수 있습니다.

이 스크립트는 다음과 같은 결과를 출력할 것입니다:

| 종목코드 | 종목명 | 상관도 1위 (계수) | 상관도 2위 (계수) | 분석 결과 |
| :--- | :--- | :--- | :--- | :--- |
| 005930 | 삼성전자 | 외국인_MA20 (0.72) | 연기금_MA60 (0.51) | 외국인 추세 추종 필요 |
| 000660 | SK하이닉스 | 기관_MA5 (0.68) | 투신_MA10 (0.45) | 기관 단기 수급 중요 |
