# PRD: 통계분석 - 투자자별 투자비율

## 문서 정보
| 항목 | 내용 |
|------|------|
| 문서명 | 통계분석 - 투자자별 투자비율 PRD |
| 작성일 | 2025-12-17 |
| 버전 | 1.0 |

---

## 요구사항 목록

### REQ-001: 차트 X축 날짜 표시 형식 변경

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-001 |
| **요구사항 제목** | 차트 X축 날짜 표시 형식 변경 (연도 표시 조건부 적용) |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 차트 분석 > 투자자이동평균분석, 투자자상관분석 - X축 날짜 레이블 |
| **요구사항 상세 내용** | X축 날짜 표시 형식을 다음과 같이 변경한다.<br><br>- **매년 1월**: `YYYY년MM월` 형식으로 표시 (예: "2025년01월")<br>- **그 외의 월**: 월만 표시 (예: "2월", "3월", "4월")<br><br>이를 통해 차트의 가독성을 높이고, 연도가 바뀌는 시점을 명확히 인지할 수 있도록 한다. |

---

### REQ-002: 통계분석 화면 레이아웃 조정 (공간 확보)

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-002 |
| **요구사항 제목** | 통계분석 화면 레이아웃 조정 - 공간 확보 |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 통계분석 공통 (이동평균, 상관분석, 수급분석) - 상단 레이아웃 영역 |
| **요구사항 상세 내용** | 차트 영역의 공간을 확보하기 위해 다음과 같이 레이아웃을 조정한다.<br><br>1. **종목분석 텍스트박스**<br>   - 크기를 축소하고 왼쪽으로 이동<br><br>2. **탭 메뉴 (이동평균, 상관분석, 수급분석)**<br>   - 한 칸 위로 이동<br><br>3. **차트 영역**<br>   - 탭 메뉴 이동에 맞춰 width 조정 (확대) |

---

### REQ-003: 투자자상관분석 줌 컨트롤 버튼 삭제

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-003 |
| **요구사항 제목** | 투자자상관분석 차트 줌 컨트롤 버튼 삭제 |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 통계분석 > 투자자상관분석 - 차트 우측 컨트롤 버튼 영역 |
| **요구사항 상세 내용** | 차트 영역 공간 확보를 위해 차트 우측에 위치한 다음 버튼들을 삭제한다.<br><br>- **"+" 확대 버튼** - 삭제<br>- **"-" 축소 버튼** - 삭제<br>- **Refresh 버튼** - 삭제 |

---

### REQ-004: 투자자이동평균 툴팁에 현재가 추가

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-004 |
| **요구사항 제목** | 투자자이동평균 차트 툴팁에 현재가 정보 추가 |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 통계분석 > 투자자이동평균 - 차트 Tooltip 컴포넌트 |
| **요구사항 상세 내용** | 그래프 위로 마우스를 이동할 때 표시되는 툴팁(Tooltip) 박스에 **"현재가"** 정보를 포함하여 표시한다.<br><br>**툴팁 표시 항목:**<br>- 날짜<br>- 현재가 (신규 추가)<br>- 각 투자자별 이동평균 값 |

---

### REQ-005: 투자자 토글버튼 위치 조정

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-005 |
| **요구사항 제목** | 투자자 토글버튼 위치 조정 |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 통계분석 공통 (이동평균, 상관분석, 수급분석) - 투자자 토글버튼 영역 |
| **요구사항 상세 내용** | 공간 확보를 위해 투자자 토글버튼 위치를 다음과 같이 조정한다.<br><br>**1. 투자자 수급 분석 화면:**<br>- 투자자 토글버튼들을 "과거 +4년" 보다 **한 칸 아래**, **오른쪽**으로 이동<br><br>**2. 이동평균, 상관분석 화면:**<br>- 투자자 토글버튼들을 **같은 칸**, **오른쪽**으로 이동 |

---

### REQ-006: 투자자별 거래 비중 계산 로직 구현

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-006 |
| **요구사항 제목** | 투자자별 거래 비중 계산 로직 구현 (Backend/Frontend) |
| **요구사항 변경 대상** | Backend |
| **요구사항 변경대상 상세** | 통계분석 서비스 - 투자자 비중 계산 API (신규 개발) |
| **요구사항 상세 내용** | 투자자별 거래 비중을 계산하는 백엔드 로직을 구현한다.<br><br>**데이터 소스:**<br>- 테이블: `tb_stock_investor_chart`<br>- 조회 대상: 해당 종목<br><br>**계산 로직:**<br>1. 각 투자자별로 **최신 날짜부터 지난 1년간**의 데이터 조회<br>2. 개별투자자의 sum(abs(cur_prc * 투자자 컬럼(순매수량)),1년)= 투자자1년 거래규모 <br>3. 전체 투자자들의 거래규모 합계를 **분모**로 설정<br>4. 투자자1년 거래규모를 **분모**로 나누어 **비중(%)** 계산<br><br>**계산 공식:**<br>```
비중(%) = (투자자1년 거래규모 / 전체 투자자 거래규모 합계) * 100
```

**Pseudo 로직:**
```
1. Initialize totalVolume = 0
2. For each investor in investors:
   a. Calculate investorVolume = SUM(ABS(cur_prc * 순매수량)) over the past year
   b. Add investorVolume to totalVolume
3. For each investor in investors:
   a. Calculate percentage = (investorVolume / totalVolume) * 100
   b. Store percentage for the investor
```

---

### REQ-007: 투자자 토글버튼 위 거래비중 막대그래프 표시

| 구분 | 내용 |
|------|------|
| **요구사항번호** | REQ-007 |
| **요구사항 제목** | 투자자 토글버튼 위 거래비중 막대그래프 표시 |
| **요구사항 변경 대상** | 화면 (Frontend) |
| **요구사항 변경대상 상세** | 통계분석 > 누적순매수금액분석 - 투자자 토글버튼 상단 영역 |
| **요구사항 상세 내용** | "현재가"를 제외한 각 투자자(외국인 ~ 내국인) 토글버튼 위에 거래 비중을 시각적으로 표시하는 UI를 구현한다.<br><br>**UI 구성:**<br>- 각 투자자 토글버튼 상단에 **작은 막대그래프** 배치<br>- 막대그래프 높이는 Backend에서 계산한 비중(%)에 비례<br>- 비중 수치를 **%** 형식으로 표시<br><br>**표시 대상 투자자:**<br>- 외국인<br>- 기관계<br>- 금융투자<br>- 보험<br>- 투신<br>- 은행<br>- 기타금융<br>- 연기금<br>- 기타법인<br>- 개인<br>- 내국인<br><br>**제외 항목:**<br>- "현재가" 토글버튼은 비중 표시 제외 |

---

## 요구사항 요약 테이블

| 요구사항번호 | 요구사항 제목 | 변경 대상 | 변경대상 상세 |
|-------------|--------------|----------|--------------|
| REQ-001 | 차트 X축 날짜 표시 형식 변경 | 화면 | 투자자이동평균분석, 투자자상관분석 - X축 레이블 |
| REQ-002 | 통계분석 화면 레이아웃 조정 | 화면 | 통계분석 공통 - 상단 레이아웃 영역 |
| REQ-003 | 투자자상관분석 줌 컨트롤 버튼 삭제 | 화면 | 투자자상관분석 - 차트 우측 컨트롤 버튼 |
| REQ-004 | 투자자이동평균 툴팁에 현재가 추가 | 화면 | 투자자이동평균 - Tooltip 컴포넌트 |
| REQ-005 | 투자자 토글버튼 위치 조정 | 화면 | 통계분석 공통 - 토글버튼 영역 |
| REQ-006 | 투자자별 거래 비중 계산 로직 | Backend | 투자자 비중 계산 API (신규) |
| REQ-007 | 투자자 토글버튼 위 거래비중 표시 | 화면 | 이동평균, 수급분석 - 토글버튼 상단 |

---

## 변경 대상 분류

### 화면 (Frontend) 변경 항목
| 요구사항번호 | 대상 화면 | 변경 내용 |
|-------------|----------|----------|
| REQ-001 | 투자자이동평균분석, 투자자상관분석 | X축 날짜 표시 형식 변경 |
| REQ-002 | 통계분석 공통 | 레이아웃 조정 (종목분석 박스, 탭, 차트) |
| REQ-003 | 투자자상관분석 | 줌 컨트롤 버튼 삭제 |
| REQ-004 | 투자자이동평균 | 툴팁에 현재가 추가 |
| REQ-005 | 통계분석 공통 | 토글버튼 위치 조정 |
| REQ-007 | 투자자이동평균, 수급분석 | 거래비중 막대그래프 추가 |

### Backend 변경 항목
| 요구사항번호 | 대상 | 변경 내용 |
|-------------|-----|----------|
| REQ-006 | 통계분석 서비스 | 투자자별 거래 비중 계산 API 신규 개발 |

### Database 참조 항목
| 요구사항번호 | 테이블 | 용도 |
|-------------|-------|-----|
| REQ-006 | `tb_stock_investor_chart` | 투자자별 거래 데이터 조회 |

---

## 참고 사항

### 관련 컬럼 정보 (tb_stock_investor_chart)
| 컬럼명 | 설명 | 비고 |
|--------|------|------|
| `cur_prc` | 현재가 | 비중 계산에 사용 |
| `pred_prc` | 예측가 | 비중 계산에 사용 |

### 비중 계산 대상 투자자
외국인, 기관계, 금융투자, 보험, 투신, 은행, 기타금융, 연기금, 기타법인, 개인, 내국인
