# 통계분석 - 데이터 수집 후 통계 작업 일괄 처리

## 1. 개요
데이터 수집(Data Collection) 페이지에서 종목 데이터 수집 작업이 완료된 직후, 별도의 사용자 개입 없이 통계 분석(이동평균, 상관분석, 수급분석)을 위한 서버 API를 자동으로 호출하여 데이터베이스 갱신 작업을 수행한다.

## 2. 상세 요구사항

### 2.1 단일 종목 선택 (종목선택)
- **동작 시점**: 사용자가 "종목선택" 모드에서 특정 종목의 데이터를 서버로부터 모두 가져오는 작업(과거/최신 수집)이 완료된 직후.
- **수행 작업**: 다음 3가지 API를 순차적으로 호출하여 데이터베이스 작업을 수행한다.
  1. **이동평균(Moving Average)** 계산
  2. **상관분석(Correlation)** 계산
  3. **수급분석(Supply/Demand)** 계산
- **UI 요구사항**: 
  - 각 단계별 API 작업이 수행될 때마다, 화면 하단의 상태 표시 영역(Status Panel)에 현재 진행 중인 작업 내용(예: "이동평균 계산 중", "상관분석 진행 중")을 실시간으로 표시해야 한다.

### 2.2 KOSPI200 일괄 수집
- **동작 시점**: "KOSPI200" 모드에서 대상 종목들(약 200개)에 대한 모든 최신 데이터 수신 작업이 완료된 직후.
- **수행 작업**: 전체 종목을 대상으로 다음 3가지 배치 작업을 순차적으로 수행한다.
  1. **전체 종목 이동평균** 일괄 계산
  2. **전체 종목 상관분석** 일괄 계산
  3. **전체 종목 수급분석** 일괄 계산

#### 2.2.1 KOSPI200 진행 상황 UI 요구사항

**Phase 구성** (2단계):
- **Phase 1: 데이터 수집**
  - KOSPI200 전체 종목(약 200개)의 최신 데이터를 순차적으로 수집
  - 현재 수집 중인 종목명 및 진행률 표시 (예: "삼성전자 (50/200)")
  - 수집 완료 시 Phase 1 완료 표시 (초록색 체크마크)

- **Phase 2: 통계DB작업**
  - 다음 3가지 통계 작업을 순차적으로 수행:
    1. 전체 종목 **이동평균** 일괄 계산 (API: `/api/statistics/moving-average/calculate`)
    2. 전체 종목 **상관분석** 일괄 계산 (API: `/api/statistics/correlation/calculate`)
    3. 전체 종목 **수급분석** 일괄 계산 (API: `/api/statistics/supply-demand/calculate`)
  - 진행 중일 때는 파란색 하이라이트, 완료 시 초록색 체크마크 표시
  - 각 작업 진행 시 현재 작업명과 날짜를 표시:
    - "이동평균-YYYY-MM-DD"
    - "투자자상관분석-YYYY-MM-DD"
    - "수급분석-YYYY-MM-DD"
  - 모든 통계 작업 완료 시 Phase 2 완료 표시

**화면 구성**:
1. **현재 단계 표시 Box**
   - "종목선택" 모드와 동일한 스타일
   - 현재 진행 중인 Phase 표시 (Phase 1: 데이터 수집 / Phase 2: 통계DB작업)
   - Phase 2 진행 시 현재 작업명과 날짜 표시 (예: "이동평균-2025-12-16")

2. **Phase 진행 상황 표시**
   - 2개의 Phase Box를 가로로 배치 (grid-cols-2)
   - 각 Phase Box 상태:
     - 대기 중: 회색 배경 (bg-gray-100, border-gray-300)
     - 진행 중: 파란색 배경 및 테두리 (bg-blue-100, border-blue-500)
     - 완료: 초록색 배경 및 테두리 (bg-green-100, border-green-500)
   - Phase 1 Box: "Phase 1: 데이터 수집"
   - Phase 2 Box: "Phase 2: 통계DB작업"

3. **실시간 작업 정보 표시**
   - Phase 1 진행 중: 현재 수집 중인 종목명 및 진행률 (예: "삼성전자 (50/200)")
   - Phase 2 진행 중: 현재 실행 중인 통계 작업명 및 날짜
     - "이동평균-2025-12-16"
     - "투자자상관분석-2025-12-16"
     - "수급분석-2025-12-16"

4. **에러 처리 및 예외 상황**
   - 수집할 데이터가 없더라도 Phase 2는 무조건 실행
   - 데이터 수집 실패 시에도 Phase 2는 무조건 실행
   - 각 Phase별로 성공/실패 여부를 명확히 표시
