
TR명 ka10060	종목별투자기관별차트요청
제목 : 종목별투자기관별차트요청 화면 수정.
URL : http://localhost:3000/data-collection

[요구사항]
1. 종목코드 입력 text 우측 끝에 "확인" 버튼추가. 
   종목에 종목명 한글로 입력 한 후 Enter를 하거나 "확인" 버튼 클릭시 Database 테이블 tb_stock_list 컬럼 name에서 조회해서 표시.
   like로 종목을 조회하고 가져온 종목이 2개 이상일 경우 "종목선택" 팝업을 띄우거나 더 좋은 방법이 있으면 구현해서 사용자가 선택하도록 한다.

2. 종목정보를 가져오면 해당 종목코드로 database tb_stock_list에서 가장 최근 날짜와 가장 오래된 날짜를 조회해서 "데이터 범위" 텍스트로 표시.
   예: "데이터 범위: 2005-01-04 ~ 2024-11-28 가 정되어 있습니다."
   표시는 종목코드 옆에 text로 표시한다


3. 수집 모드 선택 문구 변경.
   "단일 일자" --> "과거 데이터 가져오기" 로 변경
   "최근 30일" --> "현재까지 데이터 가져오기" 로 변경
   "기간 배치" --> "구간 데이터 가져오기" 로 변경

4. "조회 일자" --> "가져올 날짜"로 변경.

5- "과거 데이터 가져오기" 선택시 
    1) 최초 request body의 dt 날짜에는 Database에 저장된 정목코드의 from 날짜의 하루전 날짜로 세팅한다. 
      (가령 한국전력의 저장데이터가 2024-03-02 ~ 2024-12-20 이라고 한다면 최초 request dt는 2024-03-01이다. ) 
    2) 서버로 부터 데이터를 수신한 이후에 request dt = 수신한 데이터로 부터 가장 과거의 날짜 -1 일 로 세팅한다.
      (가령 서버로 부터 수신한 데이터의 가장 과거의 날짜가 2024-02-25 라면 다음 request dt는 2024-02-24 가 된다.)
    3) 서버에 데이터 요청을 멈추는 조건은 다음과 같다.
       서버로 부터  수신한 데이터의 가장 과거의 날짜가 사용자가 화면에 입력한 "가져올 날짜" 보다 더 과거(오래된) 날짜라면 서버에 연속요청을 멈춘다.

   처리결과 화면 수정
   요청건수는 서버에 request를 한 횟수를 표시한다.
   수신은 서버로 부터 수신한 데이터의 총 건수를 표시한다. 
   저장은 database에 정상적으로 저장된 건수를 표시한다.
   중복은 database에 저장하려고 했으나 이미 존재하는 데이터로 인한 중복건수를 표시한다.
   오류는 서버로 부터 데이터를 수신하거나 database에 저장하는 과정에서 발생한 오류건수를 표시한다. 오류데이터에 구체적인 오류 내역을 적는다.


  - "현재까지 가져오기" 선택시 
   1) 최초 request body의 dt 날짜에는 오늘 날짜로 세팅한다. 
    2) 서버로 부터 데이터를 수신한 이후에 request dt = 수신한 데이터로 부터 가장 과거의 날짜 -1 일 로 세팅한다.
      (가령 서버로 부터 수신한 데이터의 가장 과거의 날짜가 2024-02-25 라면 다음 request dt는 2024-02-24 가 된다.)
    3) 서버에 데이터 요청을 멈추는 조건은 다음과 같다.
       서버로 부터  수신한 데이터의 가장 과거의 날짜가 "종목데이터" 의 to 날짜 보다 더 과거(오래된) 날짜라면 서버에 연속요청을 멈춘다.
       (가령 종목데이터의 to 날짜가 2024-12-20 이고 서버로 부터 수신한 데이터의 가장 과거의 날짜가 2024-12-19  서버로 부터 수신한 데이터의 가장 과거의 날짜가 2024-12-19 이하인 경우에 멈춘다.)
       만약에 종목의 데이터가 없을 경우에는 서버로 부터 수신한 데이터의 가장 과거의 날짜가 2000-01-02 보다 이전날짜가 수신될때까지 연속요청을 한다.

    
  - "구간 데이터 가져오기" 
    request body의 dt 날짜 화면의 "시작일"로 세팅한다.
    만약 서버로 부터 수신한 데이터의 "가장 과거의 날짜" 데이터가, 화면의 종료일 날짜보다 최근의 날짜라면 서버에 연속요청해서 다음 날짜를 가져옴.
    만약 서버로 부터 수신한 데이터의 "가장 과거의 날짜" 데이터가,  화면의 종료일 날짜보다  최근의 날짜보다 더 과거의 날짜라면 서버에 다음데이터 요청을 멈춘다.

6. 금액/수량 구분 콤보박스 수정.
   수량 default 나머지는 비활성화

7. 매매구분 콤보박스 수정. 
   순매수 default 나머지는 비활성화

8. 단위
   원/주 default 나머지는 비활성화

9. 수신 데이터를 insert할때 중복데이터가 발생하더라도 Exception 처리하지 말고 다음 데이터 처리.
   수신데이터와 insert가 정상적으로 된 정보 , 중복데이터를 구분해 표시할수 있는 화면을 비슷한 화면 스타일로 만들어줘.
   그리고 중복 데이터는 어떤건이 발생했는지 화면에 스크롤해서 보여줘. 



10 서버의 과부하를 줄이기 위해 다음과 같은 로직을 추가한다. 
   서버에 request로 부터 수신되는 데이터는 메모리에 수신하고 5건이 되면 database에 insert하도록 한다.
   그리고 sleep(2초) 했다가 계속 연속조회 작업을 진행한다.
   
   작업을 중단하지 않고 연속조회를 진행하면서도 화면에 "데이터 범위" 및 "요청건수" ,"수신건수" ,"저장건수" ,"중복건수" ,"오류건수" 등을 비동기 적으로 갱신해 줄수 있으면 
   그렇게 구현해줘.

   그리고 현재 localhost:3000/data-collection 화면에서 오류가 남. 
   github copilot이 작업을 하다가 망처놨어. 젠장
   

   2025-10-04 추가 요구사항.
   진행상황 표시 오류가 있음.
   1) 현재종목수신 --> 현재종목수신건수 : 현재종목에 대해서만 서버에서 수신된 데이터 건수를 누적한다. 
   2) 현재종목저장 --> 현재종목저장건수 : 현재종목에 대해서만 database에 정상적으로 저장된 건수를 누적한다.
   3) 누적수신 --> 누적수신건수 : 모든종목에 대해서 서버에서 수신된 데이터 건수를 누적한다.
   4) 누적저장 --> 누적저장건수 : 모든종목에 대해서 database에 정상적으로 저장된 건수를 누적한다.
      sleep에 들어가기 전에 1) 현재종목수신 과 2)현재종목저장건수 3) 누적수신건수 4) 누적저장건수를 frontend react에 전송한
      다. 
   5) frontend react에서는 1)현재종목수신건수 2)현재종목저장건수 3)누적수신건수 4)누적저장건수를 각각 표시해 준다.
   6) 종목이 변경될때 1)현재종목수신 2)현재종목저장건수를 초기화 한다.
   7) 모든 종목이 처리되면 "현재처리 중인 항목" 박스에 "모든종목 처리 완료" 라고 표시한다.

